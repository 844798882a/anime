<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ¼«è¯„åˆ†æ®¿å ‚</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary: #3b82f6;
            --accent: #f43f5e;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --hover-row: rgba(59, 130, 246, 0.15);
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-main);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 1.2s ease-in-out;
            min-height: 100vh;
        }

        /* é®ç½©å±‚ï¼Œè®©èƒŒæ™¯å›¾æš—ä¸€ç‚¹ï¼Œæå‡æ–‡å­—å¯è¯»æ€§ */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6);
            z-index: -1;
        }

        .container {
            max-width: 1600px;
            margin: 40px auto;
            padding: 30px;
            /* æ¯›ç»ç’ƒæ•ˆæœ */
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            font-weight: 700;
            font-size: 2.5rem;
            margin-bottom: 40px;
            background: linear-gradient(to right, #60a5fa, #e879f9);
            -webkit-background-clip: text;
            color: transparent;
            letter-spacing: 2px;
        }

        /* --- æ§åˆ¶æ æ ·å¼ --- */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            padding: 12px 20px;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            width: 300px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        .tag-filter {
            flex: 1;
            display: flex;
            flex-wrap: wrap; /* å…è®¸æ ‡ç­¾æ¢è¡Œ */
            gap: 10px;
            align-items: center;
            justify-content: flex-end;
        }

        .tag-btn {
            padding: 8px 16px;
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-sub);
            transition: all 0.3s;
        }

        .tag-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: translateY(-2px);
        }

        .tag-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        /* --- è¡¨æ ¼æ ·å¼ --- */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.95rem;
        }

        th {
            padding: 16px;
            background: rgba(15, 23, 42, 0.95); /* æ·±è‰²ä¸é€æ˜èƒŒæ™¯ï¼Œé˜²æ­¢æ»šåŠ¨é‡å  */
            color: var(--text-sub);
            font-weight: 600;
            text-align: left;
            white-space: nowrap;
            cursor: pointer;
            position: sticky; /* è¡¨å¤´å†»ç»“ */
            top: 0;
            z-index: 100;
            border-bottom: 2px solid var(--glass-border);
            transition: color 0.3s;
        }

        th:hover {
            color: #fff;
            background: rgba(30, 41, 59, 1);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--glass-border);
            vertical-align: middle;
            color: var(--text-main);
        }

        tbody tr {
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.01);
        }

        tbody tr:hover {
            background: var(--hover-row);
            transform: scale(1.005);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .anime-img {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* åˆ†æ•°é“¾æ¥æ ·å¼ */
        .score-link {
            font-weight: 700;
            font-size: 1.2em;
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.3s;
            display: inline-block;
        }

        .score-link:hover {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        /* ä¿®æ­£åˆ†æ•°ä¸ºæ­£æ•°æ—¶æ˜¾ç¤ºç»¿è‰²ï¼Œè´Ÿæ•°çº¢è‰²(é€»è¾‘åœ¨JSä¸­å¤„ç†é¢œè‰²ï¼Œè¿™é‡ŒåŸºç¡€æ ·å¼) */
        .score-adj { color: var(--accent); }

        .tag-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            font-size: 0.85em;
            margin: 2px;
            white-space: nowrap;
        }

        .comment-text {
            font-size: 0.85em;
            color: var(--text-sub);
            margin-top: 6px;
            line-height: 1.4;
        }
        
        strong { color: #fff; }

        /* --- æ¨¡æ€æ¡†æ ·å¼ --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: #1e293b;
            margin: 10% auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: zoomIn 0.3s;
            color: #e2e8f0;
        }

        .close-btn {
            position: absolute;
            top: 20px; right: 25px;
            font-size: 30px;
            color: var(--text-sub);
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover { color: #fff; }

        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        @keyframes zoomIn { from {transform:scale(0.9)} to {transform:scale(1)} }

        /* --- åª’ä½“æ§åˆ¶å™¨ --- */
        .media-controls {
            position: fixed;
            bottom: 30px; right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .control-group {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .icon-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            width: 44px; height: 44px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: var(--primary);
            transform: rotate(15deg);
        }

        .music-info {
            font-size: 12px;
            color: var(--text-sub);
            width: 100px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- æ‰‹æœºç«¯é€‚é… --- */
        @media screen and (max-width: 768px) {
            .container { padding: 15px; margin: 10px; width: auto; }
            h1 { font-size: 1.8rem; margin-bottom: 20px; }
            .search-box { width: 100%; }
            .tag-filter { justify-content: center; }
            
            /* éšè—åŸæ¥çš„è¡¨å¤´ */
            thead { display: none; }
            
            /* è¡¨æ ¼å˜å¡ç‰‡ */
            table, tbody, tr, td { display: block; width: 100%; }
            
            tbody tr {
                margin-bottom: 20px;
                background: rgba(255,255,255,0.03);
                border: 1px solid var(--glass-border);
                border-radius: 12px;
                padding: 15px;
            }

            td {
                padding: 10px 0;
                border-bottom: 1px dashed rgba(255,255,255,0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: right;
            }
            
            td:last-child { border-bottom: none; }

            /* ä½¿ç”¨ data-label æ˜¾ç¤ºæ ‡ç­¾ */
            td::before {
                content: attr(data-label);
                color: var(--text-sub);
                font-weight: bold;
                text-align: left;
                margin-right: 15px;
            }

            /* ç‰¹æ®Šå¤„ç†å›¾ç‰‡å’Œåç§° */
            td[data-label="å›¾ç‰‡"] { display: block; text-align: center; border-bottom: none; padding-bottom: 5px; }
            td[data-label="å›¾ç‰‡"]::before { display: none; }
            
            td[data-label="åç§°"] {
                display: block; text-align: center;
                font-size: 1.3rem; color: #fff;
                padding-top: 0; border-bottom: 2px solid var(--glass-border);
            }
            td[data-label="åç§°"]::before { display: none; }

            /* å¯¹é½é•¿å†…å®¹ */
            .td-content { max-width: 60%; text-align: right; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>åŠ¨æ¼«è¯„åˆ†æ®¿å ‚</h1>

        <div class="controls">
            <input type="text" id="searchInput" class="search-box" placeholder="æœç´¢åŠ¨æ¼«åç§°...">
            <div id="tagFilterContainer" class="tag-filter">
                <!-- æ ‡ç­¾å°†ç”±JSç”Ÿæˆ -->
            </div>
        </div>

        <div class="table-wrapper">
            <table id="animeTable">
                <thead>
                    <tr>
                        <th style="width: 90px; text-align: center;">å›¾ç‰‡</th>
                        <th data-sort="name">åç§° <span class="sort-indicator">â†•</span></th>
                        <th data-sort="personalScore">ä¸ªäººè¯„åˆ† <span class="sort-indicator">â†•</span></th>
                        <th data-sort="production">åˆ¶ä½œ(30%) <span class="sort-indicator">â†•</span></th>
                        <th data-sort="plot">å‰§æƒ…(40%) <span class="sort-indicator">â†•</span></th>
                        <th data-sort="character">è§’è‰²(30%) <span class="sort-indicator">â†•</span></th>
                        <th data-sort="recommendationScore">æ¨èæ€»åˆ† <span class="sort-indicator">â†•</span></th>
                        <th data-sort="adjustmentScore">ä¿®æ­£åˆ†æ•° <span class="sort-indicator">â†•</span></th>
                        <th data-sort="finalScore">æœ€ç»ˆå¾—åˆ† <span class="sort-indicator">â†•</span></th>
                        <th>æ ‡ç­¾</th>
                        <th data-sort="date" class="sorted-desc">æ—¶é—´ <span class="sort-indicator">â†“</span></th>
                        <th data-sort="bangumiScore">Bangumi <span class="sort-indicator">â†•</span></th>
                    </tr>
                </thead>
                <tbody id="animeTableBody">
                    <!-- æ•°æ®è¡Œ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modalTitle" style="margin-top:0; font-size: 1.5rem;"></h2>
            <div id="modalContent" style="line-height: 1.8; font-size: 1.05rem;"></div>
        </div>
    </div>

    <!-- åª’ä½“æ§åˆ¶å™¨ -->
    <div class="media-controls">
        <div class="control-group">
            <button class="icon-btn" id="prevBgBtn" title="ä¸Šä¸€å¼ èƒŒæ™¯">ğŸ–¼ï¸</button>
            <button class="icon-btn" id="nextBgBtn" title="ä¸‹ä¸€å¼ èƒŒæ™¯">ğŸ–¼ï¸</button>
        </div>
        <div class="control-group">
            <button class="icon-btn" id="playPauseBtn" title="æ’­æ”¾/æš‚åœ">â–¶ï¸</button>
            <button class="icon-btn" id="nextTrackBtn" title="ä¸‹ä¸€é¦–">â­ï¸</button>
            <div id="musicInfo" class="music-info">ç‚¹å‡»æ’­æ”¾</div>
        </div>
    </div>
    
    <audio id="backgroundMusic" loop></audio>

    <script>
        // --- å…¨å±€å˜é‡ ---
        let animeData = [], musicTracks = [], backgroundImages = [];
        let currentFilteredData = []; // å­˜å‚¨å½“å‰æ˜¾ç¤ºçš„æ•°æ®ï¼Œç”¨äºç‚¹å‡»äº‹ä»¶
        let currentSort = { column: 'date', direction: 'desc' };
        let selectedTags = [];
        
        // åª’ä½“çŠ¶æ€
        let currentBgIndex = 0;
        let bgInterval;
        let currentTrackIndex = 0;

        // --- DOM å…ƒç´  ---
        const tableBody = document.getElementById('animeTableBody');
        const searchInput = document.getElementById('searchInput');
        const tagFilterContainer = document.getElementById('tagFilterContainer');
        const modal = document.getElementById('detailsModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const closeModalBtn = document.querySelector('.close-btn');
        const audio = document.getElementById('backgroundMusic');
        const musicInfo = document.getElementById('musicInfo');

        // --- åˆå§‹åŒ–åŠ è½½ ---
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            loadAllData();
        });

        function initEventListeners() {
            // 1. æœç´¢æ¡†
            searchInput.addEventListener('keyup', () => renderTable());

            // 2. è¡¨å¤´æ’åº (ä¿®å¤PCæ’åºçš„å…³é”®)
            document.querySelectorAll('th[data-sort]').forEach(th => {
                th.addEventListener('click', () => handleSort(th.dataset.sort));
            });

            // 3. è¡¨æ ¼å†…éƒ¨ç‚¹å‡» (äº‹ä»¶å§”æ‰˜ï¼Œä¿®å¤å¼•å·å¯¼è‡´çš„ä»£ç é”™è¯¯)
            tableBody.addEventListener('click', (e) => {
                const target = e.target.closest('.score-link');
                if (target) {
                    const index = target.dataset.index;
                    const type = target.dataset.type;
                    const item = currentFilteredData[index];
                    if(item) openModal(item, type);
                }
            });

            // 4. æ¨¡æ€æ¡†å…³é—­
            closeModalBtn.addEventListener('click', () => modal.style.display = 'none');
            window.addEventListener('click', (e) => { if(e.target === modal) modal.style.display = 'none'; });

            // 5. åª’ä½“æ§åˆ¶
            document.getElementById('prevBgBtn').onclick = () => changeBg(-1);
            document.getElementById('nextBgBtn').onclick = () => changeBg(1);
            document.getElementById('playPauseBtn').onclick = toggleMusic;
            document.getElementById('nextTrackBtn').onclick = () => changeTrack(1);
            audio.onended = () => changeTrack(1);
        }

        function loadAllData() {
            Promise.all([
                fetch('data/animeData.json').then(r => r.json()),
                fetch('data/musicData.json').then(r => r.json()),
                fetch('data/backgrounds.json').then(r => r.json())
            ]).then(([d1, d2, d3]) => {
                animeData = d1;
                musicTracks = d2;
                backgroundImages = d3;
                
                // åˆå§‹åŒ–æ¸²æŸ“
                renderTable();
                renderTags();
                initBackground();
            }).catch(err => {
                console.error(err);
                document.querySelector('.container').innerHTML = `<h2 style="text-align:center;color:red">æ•°æ®åŠ è½½å¤±è´¥<br>è¯·ç¡®ä¿JSONæ–‡ä»¶åœ¨ data/ æ–‡ä»¶å¤¹ä¸‹</h2>`;
            });
        }

        // --- æ ¸å¿ƒé€»è¾‘ï¼šæ¸²æŸ“è¡¨æ ¼ ---
        function renderTable() {
            // 1. ç­›é€‰
            const term = searchInput.value.toLowerCase();
            let data = animeData.filter(item => {
                const matchesName = item.name.toLowerCase().includes(term);
                const matchesTags = selectedTags.length === 0 || selectedTags.every(t => item.tags.includes(t));
                return matchesName && matchesTags;
            });

            // 2. æ’åº
            data.sort((a, b) => {
                let valA = getSortValue(a, currentSort.column);
                let valB = getSortValue(b, currentSort.column);
                
                // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ localeCompare
                if (typeof valA === 'string') {
                    return currentSort.direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
                }
                // å¦‚æœæ˜¯æ•°å­—
                return currentSort.direction === 'asc' ? valA - valB : valB - valA;
            });

            // ä¿å­˜å½“å‰æ•°æ®ä¾›ç‚¹å‡»äº‹ä»¶ä½¿ç”¨
            currentFilteredData = data;

            // 3. ç”Ÿæˆ HTML
            tableBody.innerHTML = '';
            data.forEach((item, index) => {
                const recScore = calcRecScore(item.recommendation);
                const finalScore = (parseFloat(recScore) + item.adjustments.score).toFixed(2);
                const adjScore = item.adjustments.score;
                
                // ä¿®æ­£åˆ†æ•°çš„é¢œè‰²
                const adjColor = adjScore > 0 ? '#4ade80' : (adjScore < 0 ? '#f87171' : '#94a3b8');
                const sign = adjScore > 0 ? '+' : '';

                const row = document.createElement('tr');
                // æ·»åŠ åŠ¨ç”»å»¶è¿Ÿ
                row.style.animation = `slideUp 0.5s ease-out ${index * 0.05}s backwards`;
                
                row.innerHTML = `
                    <td data-label="å›¾ç‰‡">
                        <img src="${item.image}" alt="${item.name}" class="anime-img" loading="lazy">
                    </td>
                    <td data-label="åç§°">
                        ${item.name}
                    </td>
                    <td data-label="ä¸ªäººè¯„åˆ†">
                        <span class="score-link" data-index="${index}" data-type="personal">
                            ${item.personalScore}
                        </span>
                    </td>
                    <td data-label="åˆ¶ä½œ(30%)">
                        <div class="td-content">
                            <strong>${item.recommendation.production}</strong>
                            <div class="comment-text">${item.recommendation.productionComment}</div>
                        </div>
                    </td>
                    <td data-label="å‰§æƒ…(40%)">
                        <div class="td-content">
                            <strong>${item.recommendation.plot}</strong>
                            <div class="comment-text">${item.recommendation.plotComment}</div>
                        </div>
                    </td>
                    <td data-label="è§’è‰²(30%)">
                        <div class="td-content">
                            <strong>${item.recommendation.character}</strong>
                            <div class="comment-text">${item.recommendation.characterComment}</div>
                        </div>
                    </td>
                    <td data-label="æ¨èæ€»åˆ†">
                        <strong>${recScore}</strong>
                    </td>
                    <td data-label="ä¿®æ­£åˆ†æ•°">
                        <span class="score-link" style="color:${adjColor}" data-index="${index}" data-type="adjustment">
                            ${sign}${adjScore}
                        </span>
                    </td>
                    <td data-label="æœ€ç»ˆå¾—åˆ†">
                        <strong style="color: #fbbf24; font-size: 1.1em;">${finalScore}</strong>
                    </td>
                    <td data-label="æ ‡ç­¾">
                        <div class="td-content">
                            ${item.tags.map(t => `<span class="tag-badge">${t}</span>`).join('')}
                        </div>
                    </td>
                    <td data-label="æ—¶é—´">${item.date}</td>
                    <td data-label="Bangumi">${item.bangumiScore}</td>
                `;
                tableBody.appendChild(row);
            });

            updateSortIcons();
        }

        // è¾…åŠ©ï¼šè·å–æ’åºå€¼
        function getSortValue(item, col) {
            switch(col) {
                case 'production': return item.recommendation.production;
                case 'plot': return item.recommendation.plot;
                case 'character': return item.recommendation.character;
                case 'recommendationScore': return parseFloat(calcRecScore(item.recommendation));
                case 'adjustmentScore': return item.adjustments.score;
                case 'finalScore': 
                    return parseFloat(calcRecScore(item.recommendation)) + item.adjustments.score;
                case 'date': return new Date(item.date).getTime(); // è½¬æ¢ä¸ºæ—¶é—´æˆ³æ’åºæ›´å‡†
                default: return item[col];
            }
        }

        // è¾…åŠ©ï¼šè®¡ç®—æ¨èåˆ†
        function calcRecScore(r) {
            return (r.production * 0.3 + r.plot * 0.4 + r.character * 0.3).toFixed(2);
        }

        // --- äº¤äº’é€»è¾‘ ---
        function handleSort(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc'; // é»˜è®¤å‡åº
            }
            renderTable();
        }

        function updateSortIcons() {
            document.querySelectorAll('th[data-sort]').forEach(th => {
                const icon = th.querySelector('.sort-indicator');
                th.style.color = ''; // é‡ç½®é¢œè‰²
                icon.textContent = 'â†•';
                
                if (th.dataset.sort === currentSort.column) {
                    th.style.color = '#fff'; // é€‰ä¸­é«˜äº®
                    icon.textContent = currentSort.direction === 'asc' ? 'â†‘' : 'â†“';
                }
            });
        }

        function renderTags() {
            const allTags = [...new Set(animeData.flatMap(i => i.tags))];
            tagFilterContainer.innerHTML = '';
            // æ·»åŠ â€œå…¨éƒ¨â€æˆ–æç¤ºæ–‡æœ¬
            tagFilterContainer.innerHTML = '<span style="color:var(--text-sub); font-size:14px;">ç­›é€‰:</span>';
            
            allTags.forEach(tag => {
                const btn = document.createElement('button');
                btn.className = 'tag-btn';
                btn.textContent = tag;
                btn.onclick = () => {
                    if (selectedTags.includes(tag)) {
                        selectedTags = selectedTags.filter(t => t !== tag);
                        btn.classList.remove('active');
                    } else {
                        selectedTags.push(tag);
                        btn.classList.add('active');
                    }
                    renderTable();
                };
                tagFilterContainer.appendChild(btn);
            });
        }

        function openModal(item, type) {
            if (type === 'personal') {
                modalTitle.textContent = `${item.name} - ä¸ªäººè¯„ä»·`;
                modalContent.innerHTML = `<p>${item.personalEvaluation}</p>`;
            } else if (type === 'adjustment') {
                modalTitle.textContent = `${item.name} - ä¿®æ­£è¯¦æƒ…`;
                const adj = item.adjustments;
                modalContent.innerHTML = `
                    <p><strong style="color:#f87171">äº‰è®®å†…å®¹:</strong> ${adj.controversy || 'æ— '}</p>
                    <p><strong style="color:#60a5fa">å†…æ ¸æ·±åº¦:</strong> ${adj.depth || 'æ— '}</p>
                    <p><strong style="color:#a78bfa">ç¤¾ä¼šå½±å“:</strong> ${adj.impact || 'æ— '}</p>
                    <p><strong style="color:#fbbf24">è‰ºæœ¯è¡¨è¾¾:</strong> ${adj.artistry || 'æ— '}</p>
                    <hr style="border-color:rgba(255,255,255,0.1)">
                    <p>ä¿®æ­£æ€»å€¼: <strong>${adj.score > 0 ? '+' : ''}${adj.score}</strong></p>
                `;
            }
            modal.style.display = 'block';
        }

        // --- åª’ä½“é€»è¾‘ ---
        function initBackground() {
            if(backgroundImages.length > 0) {
                document.body.style.backgroundImage = `url('${backgroundImages[0]}')`;
                startBgTimer();
            }
        }

        function changeBg(dir) {
            if(!backgroundImages.length) return;
            clearInterval(bgInterval);
            currentBgIndex = (currentBgIndex + dir + backgroundImages.length) % backgroundImages.length;
            document.body.style.backgroundImage = `url('${backgroundImages[currentBgIndex]}')`;
            startBgTimer();
        }

        function startBgTimer() {
            bgInterval = setInterval(() => changeBg(1), 20000);
        }

        function toggleMusic() {
            if(!musicTracks.length) return;
            if(audio.paused) {
                if(!audio.src) {
                    audio.src = musicTracks[0].src;
                    musicInfo.textContent = musicTracks[0].name;
                }
                audio.play();
                document.getElementById('playPauseBtn').textContent = 'â¸ï¸';
                musicInfo.textContent = musicTracks[currentTrackIndex].name;
            } else {
                audio.pause();
                document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';
                musicInfo.textContent = 'æš‚åœä¸­';
            }
        }

        function changeTrack(dir) {
            if(!musicTracks.length) return;
            currentTrackIndex = (currentTrackIndex + dir + musicTracks.length) % musicTracks.length;
            audio.src = musicTracks[currentTrackIndex].src;
            audio.play();
            document.getElementById('playPauseBtn').textContent = 'â¸ï¸';
            musicInfo.textContent = musicTracks[currentTrackIndex].name;
        }

    </script>
</body>
</html>