<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âä®Êº´ËØÑÂàÜÊÆøÂ†Ç</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --primary-color: #16213e;
            --secondary-color: #0f3460;
            --accent-color: #e94560;
            --text-color: #dcdcdc;
            --text-muted-color: #a0a0a0;
            --border-color: #2a2a4a;
            --hover-bg-color: #1f2b4e;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0;
            padding: 40px 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 1.5s ease-in-out;
        }

        .container {
            max-width: 1600px;
            margin: auto;
            background: rgba(22, 33, 62, 0.9);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid var(--border-color);
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }

        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center; color: #fff; font-weight: 700;
            letter-spacing: 2px; margin-bottom: 30px;
        }

        .controls {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; flex-wrap: wrap; gap: 15px;
        }

        .search-box {
            padding: 10px 15px; border: 1px solid var(--border-color);
            border-radius: 6px; font-size: 16px;
            background-color: var(--primary-color); color: var(--text-color);
            width: 250px; transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none; border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
        }

        .tag-filter button {
            padding: 8px 15px; border: 1px solid var(--border-color);
            border-radius: 15px; font-size: 14px; cursor: pointer;
            background-color: var(--secondary-color); color: var(--text-color);
            margin: 0 5px; transition: all 0.3s ease;
        }

        .tag-filter button:hover { background-color: var(--hover-bg-color); }
        .tag-filter button.active {
            background-color: var(--accent-color); color: #fff;
            border-color: var(--accent-color);
        }

        table {
            width: 100%; border-collapse: collapse;
            margin-top: 20px; font-size: 0.95em;
        }

        th, td {
            padding: 12px 10px; border-bottom: 1px solid var(--border-color);
            text-align: left; vertical-align: middle;
        }

        th {
            background-color: rgba(15, 52, 96, 0.5); cursor: pointer;
            user-select: none; white-space: nowrap; font-weight: 400;
        }
        
        tr { transition: all 0.2s ease-out; }
        tbody tr:hover {
            background-color: var(--hover-bg-color);
            transform: scale(1.01); box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            z-index: 10; position: relative;
        }
        
        th .sort-indicator { float: right; margin-left: 5px; color: var(--text-muted-color); }
        th.sorted-asc .sort-indicator, th.sorted-desc .sort-indicator { color: #fff; }

        .anime-img {
            width: 70px; height: 105px; object-fit: cover;
            border-radius: 6px; display: block; margin: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .score {
            font-weight: 700; font-size: 1.1em; cursor: pointer;
            color: #61dafb; text-decoration: none; display: inline-block;
            transition: color 0.3s;
        }
        .score:hover { color: var(--accent-color); text-shadow: 0 0 8px var(--accent-color); }
        
        td strong { font-size: 1.1em; font-weight: 700; }

        .tags span {
            background-color: var(--secondary-color); padding: 4px 10px;
            border-radius: 12px; margin: 2px; font-size: 0.85em; display: inline-block;
        }
        
        .modal {
            display: none; position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px); animation: fadeIn 0.4s;
        }

        .modal-content {
            background-color: var(--primary-color); color: var(--text-color);
            margin: 12% auto; padding: 25px; border: 1px solid var(--border-color);
            width: 90%; max-width: 550px; border-radius: 10px; position: relative;
            animation: slideIn 0.4s; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        @keyframes slideIn { from {transform: translateY(-50px);} to {transform: translateY(0);} }

        .close-btn {
            color: #aaa; position: absolute; top: 15px; right: 20px;
            font-size: 32px; font-weight: bold; transition: color 0.3s;
        }
        .close-btn:hover, .close-btn:focus { color: var(--accent-color); text-decoration: none; cursor: pointer; }
        
        .details-comment { font-size: 0.9em; color: var(--text-muted-color); margin-top: 5px; font-weight: 300; }
        #modal-content-details { line-height: 1.7; }

        .media-controls {
            position: fixed; bottom: 20px; right: 20px; display: flex;
            flex-direction: column; gap: 15px; z-index: 999;
        }
        .control-group {
            background: rgba(22, 33, 62, 0.8); padding: 10px;
            border-radius: 8px; display: flex; align-items: center;
            gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        .media-controls button {
            background: var(--secondary-color); border: 1px solid var(--border-color);
            color: white; width: 40px; height: 40px; border-radius: 50%;
            cursor: pointer; font-size: 18px; display: flex;
            align-items: center; justify-content: center; transition: all 0.3s ease;
        }
        .media-controls button:hover { background: var(--accent-color); }
        .music-info {
            font-size: 12px; text-align: center; color: var(--text-muted-color);
            width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* --- NEW: MOBILE ADAPTATION STYLES --- */
        @media screen and (max-width: 768px) {
            body { padding: 20px 10px; }
            .container { padding: 15px; }
            h1 { font-size: 1.5em; }
            
            .controls { flex-direction: column; align-items: stretch; }
            .search-box { width: auto; }
            .tag-filter { text-align: center; }

            table thead { display: none; }
            table, tbody, tr, td { display: block; width: 100%; box-sizing: border-box; }
            
            tbody tr {
                margin-bottom: 20px;
                padding: 15px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
            }

            tbody tr:hover { transform: scale(1.02); }

            td {
                padding: 8px 0;
                border-bottom: 1px dashed var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            td:last-child { border-bottom: none; }

            td::before {
                content: attr(data-label);
                font-weight: bold;
                margin-right: 10px;
                color: var(--text-muted-color);
            }
            
            td[data-label="ÂõæÁâá"] { display: block; text-align: center; padding-bottom: 15px; }
            td[data-label="ÂõæÁâá"]::before { display: none; }
            .anime-img { width: 100px; height: 150px; }

            td[data-label="ÂêçÁß∞"] {
                flex-direction: column;
                font-size: 1.2em;
                font-weight: bold;
                color: #fff;
                padding-bottom: 10px;
                align-items: flex-start;
            }
            td[data-label="ÂêçÁß∞"]::before { display: none; }

            .details-comment { max-width: 60%; }
            .tags { flex-wrap: wrap; justify-content: flex-end; }
            .tags span { margin-top: 5px; }

            .media-controls { bottom: 10px; right: 10px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Âä®Êº´ËØÑÂàÜÊÆøÂ†Ç</h1>
        <div class="controls">
            <input type="text" id="searchInput" class="search-box" onkeyup="filterTable()" placeholder="ÊêúÁ¥¢Âä®Êº´ÂêçÁß∞...">
            <div id="tagFilterContainer" class="tag-filter"><span>Á≠õÈÄâÊ†áÁ≠æ: </span></div>
        </div>
        <table>
            <thead>
                <tr>
                    <th style="width: 90px; text-align: center;">ÂõæÁâá</th>
                    <th data-sort="name">ÂêçÁß∞<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="personalScore">‰∏™‰∫∫ËØÑÂàÜ<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="production">Âà∂‰Ωú(30%)<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="plot">ÂâßÊÉÖ(40%)<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="character">ËßíËâ≤(30%)<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="recommendationScore">Êé®ËçêÊÄªÂàÜ<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="adjustmentScore">‰øÆÊ≠£ÂàÜÊï∞<span class="sort-indicator">‚Üï</span></th>
                    <th data-sort="finalScore">ÊúÄÁªàÂæóÂàÜ<span class="sort-indicator">‚Üï</span></th>
                    <th>Ê†áÁ≠æ</th>
                    <th data-sort="date" class="sorted-desc">Êó∂Èó¥<span class="sort-indicator">‚Üì</span></th>
                    <th data-sort="bangumiScore">Bangumi<span class="sort-indicator">‚Üï</span></th>
                </tr>
            </thead>
            <tbody id="animeTableBody"></tbody>
        </table>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2 id="modalTitle"></h2>
            <div id="modal-content-details"></div>
        </div>
    </div>

    <div class="media-controls">
        <div class="control-group">
            <button id="prevBgBtn" title="‰∏ä‰∏ÄÂº†ËÉåÊôØ">üñºÔ∏è</button>
            <button id="nextBgBtn" title="‰∏ã‰∏ÄÂº†ËÉåÊôØ">üñºÔ∏è</button>
        </div>
        <div class="control-group">
            <button id="playPauseBtn" title="Êí≠Êîæ/ÊöÇÂÅú">‚ñ∂Ô∏è</button>
            <button id="nextTrackBtn" title="‰∏ã‰∏ÄÈ¶ñ">‚è≠Ô∏è</button>
            <div id="musicInfo" class="music-info">ÊöÇÂÅú‰∏≠</div>
        </div>
    </div>
    
    <audio id="backgroundMusic" loop></audio>

    <script>
        // Data will be loaded from JSON files
        let animeData = [], musicTracks = [], backgroundImages = [];
        
        const tableBody = document.getElementById('animeTableBody');
        const searchInput = document.getElementById('searchInput');
        const tagFilterContainer = document.getElementById('tagFilterContainer');
        const modal = document.getElementById('detailsModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modal-content-details');
        const closeBtn = document.getElementsByClassName("close-btn")[0];
        
        let currentSort = { column: 'date', direction: 'desc' };
        let selectedTags = [];

        function showModal(title, contentHTML) {
            modalTitle.textContent = title;
            modalContent.innerHTML = contentHTML;
            modal.style.display = "block";
        }
        closeBtn.onclick = () => modal.style.display = "none";
        window.onclick = (event) => { if (event.target == modal) modal.style.display = "none"; };

        const calculateRecommendationScore = (rec) => (rec.production * 0.3 + rec.plot * 0.4 + rec.character * 0.3).toFixed(2);
        const calculateFinalScore = (recScore, adjScore) => (parseFloat(recScore) + adjScore).toFixed(2);

        function renderTable() {
            tableBody.innerHTML = '';
            const filteredData = animeData.filter(anime => 
                anime.name.toLowerCase().includes(searchInput.value.toLowerCase()) &&
                (selectedTags.length === 0 || selectedTags.every(tag => anime.tags.includes(tag)))
            );
            
            filteredData.sort((a, b) => {
                const getVal = (item, column) => {
                    switch (column) {
                        case 'production': return item.recommendation.production;
                        case 'plot': return item.recommendation.plot;
                        case 'character': return item.recommendation.character;
                        case 'recommendationScore': return calculateRecommendationScore(item.recommendation);
                        case 'adjustmentScore': return item.adjustments.score;
                        case 'finalScore': return calculateFinalScore(calculateRecommendationScore(item.recommendation), item.adjustments.score);
                        case 'date': return new Date(item.date);
                        default: return item[column];
                    }
                };
                const aVal = getVal(a, currentSort.column);
                const bVal = getVal(b, currentSort.column);
                if (currentSort.direction === 'asc') return typeof aVal === 'string' ? aVal.localeCompare(bVal) : aVal - bVal;
                else return typeof aVal === 'string' ? bVal.localeCompare(aVal) : bVal - aVal;
            });

            filteredData.forEach(anime => {
                const recScore = calculateRecommendationScore(anime.recommendation);
                const finalScore = calculateFinalScore(recScore, anime.adjustments.score);
                const adj = anime.adjustments;
                const adjHTML = `<p><strong>‰∫âËÆÆÂÜÖÂÆπ:</strong> ${adj.controversy||'Êó†'}</p><p><strong>ÂÜÖÊ†∏Ê∑±Â∫¶:</strong> ${adj.depth||'Êó†'}</p><p><strong>Á§æ‰ºöÂΩ±Âìç:</strong> ${adj.impact||'Êó†'}</p><p><strong>Ëâ∫ÊúØË°®Ëææ:</strong> ${adj.artistry||'Êó†'}</p>`;

                // UPDATED: Added data-label attributes for mobile view
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-label="ÂõæÁâá"><img src="${anime.image}" alt="${anime.name}" class="anime-img"></td>
                    <td data-label="ÂêçÁß∞">${anime.name}</td>
                    <td data-label="‰∏™‰∫∫ËØÑÂàÜ"><span class="score" onclick='showModal("${anime.name} - ‰∏™‰∫∫ËØÑ‰ª∑", "<p>${anime.personalEvaluation}</p>")'>${anime.personalScore}</span></td>
                    <td data-label="Âà∂‰Ωú(30%)"><div><strong>${anime.recommendation.production}</strong><div class="details-comment">${anime.recommendation.productionComment}</div></div></td>
                    <td data-label="ÂâßÊÉÖ(40%)"><div><strong>${anime.recommendation.plot}</strong><div class="details-comment">${anime.recommendation.plotComment}</div></div></td>
                    <td data-label="ËßíËâ≤(30%)"><div><strong>${anime.recommendation.character}</strong><div class="details-comment">${anime.recommendation.characterComment}</div></div></td>
                    <td data-label="Êé®ËçêÊÄªÂàÜ"><strong>${recScore}</strong></td>
                    <td data-label="‰øÆÊ≠£ÂàÜÊï∞"><span class="score" onclick='showModal("${anime.name} - ÂàÜÊï∞‰øÆÊ≠£ËØ¶ÊÉÖ", ${JSON.stringify(adjHTML)})'>${adj.score > 0 ? '+' : ''}${adj.score}</span></td>
                    <td data-label="ÊúÄÁªàÂæóÂàÜ"><strong>${finalScore}</strong></td>
                    <td data-label="Ê†áÁ≠æ"><div class="tags">${anime.tags.map(tag => `<span>${tag}</span>`).join(' ')}</div></td>
                    <td data-label="Êó∂Èó¥">${anime.date}</td>
                    <td data-label="Bangumi">${anime.bangumiScore}</td>
                `;
                tableBody.appendChild(row);
            });
            updateSortIndicators();
        }
        
        function renderTagFilters() {
            const allTags = [...new Set(animeData.flatMap(a => a.tags))];
            allTags.forEach(tag => {
                const button = document.createElement('button');
                button.textContent = tag;
                button.onclick = () => toggleTag(tag, button);
                tagFilterContainer.appendChild(button);
            });
        }

        const filterTable = () => renderTable();
        function toggleTag(tag, button) {
            const index = selectedTags.indexOf(tag);
            if (index > -1) { selectedTags.splice(index, 1); button.classList.remove('active'); } 
            else { selectedTags.push(tag); button.classList.add('active'); }
            renderTable();
        }

        function sortTable(column) {
            if (currentSort.column === column) currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            else { currentSort.column = column; currentSort.direction = 'asc'; }
            renderTable();
        }
        
        function updateSortIndicators() {
            document.querySelectorAll('#animeTable th[data-sort]').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
                const indicator = th.querySelector('.sort-indicator');
                if (indicator) indicator.textContent = '‚Üï';
                if (th.dataset.sort === currentSort.column) {
                    th.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                    if(indicator) indicator.textContent = currentSort.direction === 'asc' ? '‚Üë' : '‚Üì';
                }
            });
        }
        document.querySelectorAll('#animeTable th[data-sort]').forEach(header => header.addEventListener('click', () => sortTable(header.dataset.sort)));

        let currentBgIndex = 0, bgInterval, currentTrackIndex = 0;
        const audio = document.getElementById('backgroundMusic');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const nextTrackBtn = document.getElementById('nextTrackBtn');
        const musicInfo = document.getElementById('musicInfo');

        function changeBackground(direction) {
            if (backgroundImages.length === 0) return;
            currentBgIndex = (currentBgIndex + direction + backgroundImages.length) % backgroundImages.length;
            document.body.style.backgroundImage = `url('${backgroundImages[currentBgIndex]}')`;
        }
        function startBgAutoplay() {
            if (bgInterval) clearInterval(bgInterval);
            bgInterval = setInterval(() => changeBackground(1), 20000);
        }
        function playPauseMusic() {
            if (musicTracks.length === 0) return;
            if (audio.paused) { if(!audio.src) changeTrack(0); audio.play(); playPauseBtn.textContent = '‚è∏Ô∏è'; } 
            else { audio.pause(); playPauseBtn.textContent = '‚ñ∂Ô∏è'; }
            updateMusicInfo();
        }
        function changeTrack(direction) {
            if (musicTracks.length === 0) return;
            currentTrackIndex = (currentTrackIndex + direction + musicTracks.length) % musicTracks.length;
            audio.src = musicTracks[currentTrackIndex].src;
            if (playPauseBtn.textContent === '‚è∏Ô∏è') audio.play();
            updateMusicInfo();
        }
        function updateMusicInfo() {
            if (musicTracks.length > 0) {
                 musicInfo.textContent = audio.paused ? 'ÊöÇÂÅú‰∏≠' : musicTracks[currentTrackIndex].name;
                 musicInfo.title = musicTracks[currentTrackIndex].name;
            } else { musicInfo.textContent = 'Êó†Èü≥‰πê'; }
        }
        document.getElementById('prevBgBtn').onclick = () => { changeBackground(-1); startBgAutoplay(); };
        document.getElementById('nextBgBtn').onclick = () => { changeBackground(1); startBgAutoplay(); };
        playPauseBtn.onclick = playPauseMusic;
        nextTrackBtn.onclick = () => changeTrack(1);
        audio.onended = () => changeTrack(1);

        document.addEventListener('DOMContentLoaded', () => {
            // UPDATED: Fetching from new filenames
            const fetchData = fetch('data/animeData.json').then(res => res.json());
            const fetchMusic = fetch('data/musicData.json').then(res => res.json());
            const fetchBackgrounds = fetch('data/backgrounds.json').then(res => res.json());
            
            Promise.all([fetchData, fetchMusic, fetchBackgrounds])
                .then(([animeListData, musicListData, backgroundListData]) => {
                    animeData = animeListData;
                    musicTracks = musicListData;
                    backgroundImages = backgroundListData;
                    renderTable();
                    renderTagFilters();
                    changeBackground(0);
                    startBgAutoplay();
                    updateMusicInfo();
                })
                .catch(error => {
                    console.error("Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:", error);
                    document.querySelector('.container').innerHTML = '<h1>Êä±Ê≠âÔºåÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•`data`Êñá‰ª∂Â§π‰∏≠ÁöÑJSONÊñá‰ª∂ÊòØÂê¶Â≠òÂú®‰∏îË∑ØÂæÑÊ≠£Á°Æ„ÄÇ</h1>';
                });
        });
    </script>
</body>
</html>